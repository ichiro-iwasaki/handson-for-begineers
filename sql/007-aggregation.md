# ステップ7：集計関数
このステップではデータ集計に使われるSQLの関数について学びます。

## 集計関数
指定したカラムについて集計を行う関数です。  
集計関数はカラムと同じようにSELECT句の後ろに記載します。  

```sql
SELECT 集計関数(カラム名) FROM テーブル名;
```

代表的な集計関数には以下があります。

|集計関数|意味|
| --- | --- |
| SUM | 引数に指定したカラムの合計値を計算します |
| AVG | 引数に指定したカラムの平均値を計算します |
| COUNT | 引数に指定したカラムに値が存在するレコードの数を計算します。 |
| MAX | 引数に指定したカラムの最大値を計算します |
| MIN | 引数に指定したカラムの最小値を計算します |

それでは実際に集計関数を活用したSQLを実行してみましょう。  

## ハンズオン
userテーブルの登録データにおける平均年齢(ageカラム)を求めます。  
平均を求めるには**AVG関数**を使用します。

**[7-1]平均年齢の計算**

```sql
SELECT AVG(age) FROM user;
```

![AVG関数](https://user-images.githubusercontent.com/22129880/92441006-635d7f80-f1e8-11ea-91b7-7e437bff6641.png)

画像のように平均年齢が計算されていることがわかると思います。  

次に、shopテーブルの登録されている店舗の合計売上額を求めます。  
合計を求めるには**SUM関数**を使用します。  

**[7-2]合計売上額の計算**
```sql
SELECT SUM(sales) FROM shop;
```

次に、visitテーブルのレコード数を求めます。  
レコード数を求めるには**COUNT関数**を使用します。  

**[7-3]レコード数の計算**
```sql
SELECT COUNT(*) FROM visit;
```

## 補足
WHERE句と組み合わせて条件に一致したレコードのみ集計することが可能です。  

**[7-4]userテーブルに登録されているデータより、男性の平均年齢を求める**
```sql
SELECT AVG(age) FROM user WHERE sex = '男性';
```

カラムと同様にAS句を使用してわかりやすい表示名を付けることもよく行われます。

**[7-5]AS句を使用して集計結果に別名を付ける**
```sql
SELECT AVG(age) AS 平均年齢 FROM user;
```

## 練習問題
1. visitテーブルにおける評価(rankカラム)の平均値を求めましょう。  
また、AS句を使用して「平均評価」という別名を付けて表示させましょう。  
2. userテーブルに登録されているユーザデータから30代のユーザの人数を求めてみましょう。  
年齢はageカラムに格納されています。  
また、AS句を使用して「30代ユーザーの人数」という別名を付けて表示させましょう。  

回答は[こちら](007-aggregation-answer.md)  

前のステップ：[並び替えと制限](006-sort-and-limit.md)  
次のステップ：[グループ化](008-group.md)  
[目次に戻る](README.md)
